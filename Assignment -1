create table member
(memid numeric(5) primary key,mname char(25),accOpDt date,
maxbook numeric,penAmt numeric(7,2))

create table book
(bookno numeric(6) primary key, bname varchar(30), author varchar(30),
cost numeric(7,2),category varchar(10))

create table Issue
(libIssue numeric(10), bookno numeric(6),mid numeric(5), issDate date, reDate date)

sp_help member
sp_help book
sp_help Issue

alter table Issue add comments varchar(100)

alter table Issue drop column reference
---how to rename --
alter table Issue Rename to lib_issue --WRONG
---
sp_rename Issue,lib_Issue		--CORRECT
sp_help lib_Issue

insert into member values(1,'Richa Sharma', '10-Dec-05',5,50)
insert into member values(2,'Garima Sen',getDate(),3,NULL)
insert into member values(3,'Mary Jane',NULL,4,125)
insert into member values(4,'Bella Hadrid','26-Jul-07',10,35)
insert into member values(5,'Emma Watson','09-May-06',NULL,200)

alter table member alter column mname char(20)
select *from member
insert into member values(6,'Robert Stew','30-Aug-08',110,3000)

create table Member101
(memid numeric(5) primary key,mname char(25),accOpDt date,
maxbook numeric,penAmt numeric(7,2))

select*from book
update book set cost=300, category='RDMS' where bookno=103
insert into Issue(libissue,bookno,mid,issDate) 
values(7001,101,1,'10-Dec-06')
insert into Issue(libissue,bookno,mid,issDate) values(7002,102,2,'25-Dec-06')
insert into Issue(libissue,bookno,mid,issDate) values(7003,104,1,'15-Jan-06')
insert into Issue(libissue,bookno,mid,issDate) values(7004,101,1,'14-Jul-06')
insert into Issue(libissue,bookno,mid,issDate) values(7005,104,2,'15-Nov-06')
insert into Issue(libissue,bookno,mid,issDate) values(7006,101,3,'18-Feb-06')

sp_help book
create table Book101(BookNum numeric(6) primary key, BookName varchar(30),
Author varchar(30), Price numeric(7,2), BookCatgory varchar(10))

insert into Book101
select bookno,bname,author,cost,category from Book

select *from Book101
select *from Issue
select *from member

----category and book count
select category,count(bookno) [Book Count] from book group by category
---no of times book issued desc
select bookno,count(bookno) No_Issued from Issue group by bookno order by No_Issued desc
--penalty
select max(penAmt) Max_Penalty, min(penAmt) Min_Penalty,
sum(penAmt) Total,avg(penAmt) Average from member
--issued more than 2 books
select mid,count(bookno) from Issue group by mid having count(bookno)>2
--no of times same book issued by the member
select mid,bookno,count(mid) No_Issued from Issue group by mid,bookno order by No_Issued desc
----no of books issued each month
select month(issDate) issue_Month,count(bookno) bk_count from Issue group by month(issDate) order by bk_count desc
--not issued to any member
select bookno from Book except select bookno from Issue
--member that issued atleast 1 book
select memid from member m where exists (select mid from issue i where m.memid=i.mid) 
----------------------------------------------------------------------------------------------------------------------
select mid from Issue  (select count(bookno) Coun from Issue i group by mid)

select mid,count(mid) from Issue i
group by mid
having count(mid)=(select max(count(mid)) from Issue where mid=i.mid group by mid)
--------
select mid, mincount.A,maxcount.B from Issue 
group by mid 
having (count(mid)=(select top 1 count(mid) as A from Issue group by mid order by count(mid)) )mincount
and (count(mid)=(select top 1 count(mid) as B from issue group by mid order by count(mid) desc))maxcount
order by count(mid) desc

--select mid from Issue group by mid 
select mid, count(mid) from Issue 
having count(mid)=
(select top 1 mid,count(mid) from issue 
group by mid 
order by count(mid))
--------------------------------------------------------------------------------------------------------------------------
----min and max
select mincount.mid [Member id],mincount.A [Min Books Issued],maxcount.mid [Member id], maxcount.B [Max Books Issued] from 
(select top 1 mid, count(mid) as A from Issue group by mid order by count(mid)) mincount,
(select top 1 mid, count(mid) as B from issue group by mid order by count(mid) desc)maxcount


